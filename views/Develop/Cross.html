<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>基础知识</title>
	<link href="../static/css/bootstrap.min.css" rel="stylesheet">
	<link href="../static/css/animate.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../static/css/public.css" />
	<style type="text/css">
		li{
			text-indent: 2em;
		}
	</style>
</head>
<body>
	<!--右边内容-->
	<div id="app" class="main animated fadeInRight">
		<div class="shadow">
			<div>
				<h4>跨域iframe传值</h4>
				<p>
					postMessage()方法允许来自不同源的脚本采用异步方式进行有限的通信，
					可以实现跨文本档、多窗口、跨域消息传递.
					postMessage(data,origin)方法接受两个参数：
				</p>
				<ul>
					<li>
						data:要传递的数据，html5规范中提到该参数可以是JavaScript的任意基本类型或可复制的对象，
						然而并不是所有浏览器都做到了这点儿，部分浏览器只能处理字符串参数，
						所以我们在传递参数的时候需要使用JSON.stringify()方法对对象参数序列化，
						在低版本IE中引用json2.js可以实现类似效果，
					</li>
					<li>
						origin：字符串参数，指明目标窗口的源，
						协议+主机+端口号[+URL]，URL会被忽略，
						所以可以不写，这个参数是为了安全考虑，
						postMessage()方法只会将message传递给指定窗口，
						当然如果愿意也可以建参数设置为"*"，
						这样可以传递给任意窗口，如果要指定和当前窗口同源的话设置为"/"；
					</li>
				</ul>
				<pre>
		&lt;iframe src="http://192.168.1.5:8020/2018-07~11project/跨域iframe传值/b.html"
			name="postIframe" onload="messageLoad()"&gt;&lt;/iframe&gt;
		&lt;script&gt;
			function messageLoad() {
				var url = "http://192.168.1.5:8020";
				window.postIframe.postMessage("给我post传递的信息", url); //发送数据
			}

			window.onmessage = function(e) {
				e = e || event;
				console.log(e.data); //接收b返回的数据，在控制台有两次输出
			}
		&lt;/script&gt;
		
		iframe页面
		&lt;script&gt;
			/*window.addEventListener('message',function(e){})方法也可以*/
			window.onmessage = function(e) {
				e = e || event;
				alert(e.data); //立即弹出a发送过来的数据
				e.source.postMessage("好的，请稍等三秒！", e.origin); //立即回复a

				var postData = {
					name: "tsrot",
					age: 24
				};
				var strData = JSON.stringify(postData); //json对象转化为字符串
				setTimeout(function() {
					e.source.postMessage(strData, e.origin);
				}, 3000); //3秒后向a发送数据
			}
		&lt;/script&gt;				
				</pre>
				<p>
					注意：跨域地址一定要一致，不能输入错误，一定是浏览器前面的域名地址。
				</p>
			</div>
		</div>
	</div>
	<!--页面加载进度条-->
	<script src="../static/js/plugins/pace/pace.min.js"></script>
	
</body>

</html>